"use strict";angular.module("ngGather",["pascalprecht.translate","ui.router","ui.bootstrap","ngResource","angular-loading-bar","ngAnimate","pc035860.scrollWatch","ngAside"]).config(["$locationProvider","$translateProvider",function(t,e){e.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),e.preferredLanguage("zh-hans"),t.html5Mode(!1)}]),angular.module("ngGather").service("errorHandlingService",["$state","$translate","notificationService",function(t,e,n){var a=this;this.handleError=function(t){if(_.isObject(t)){if(t.data&&t.data.err)return n.error(e.instant("error."+t.data.err));if(t.status){var a="httpStatusMessage."+t.status,i=e.instant(a);return a===i&&(a="httpStatusMessage.0",i=e.instant(a)),n.error(i)}}_.isString(t)&&n.error(e.instant(t))},this.handleHttpError=function(t,e){a.handleError({status:e,data:t})}}]),angular.module("ngGather").constant("SERVERURL","http://nggather.coding.io").constant("ALL_SITES",[{name:"ZD423",ischecked:!0,description:"专注绿软，分享软件、传递最新软件资讯",url:"http://www.zdfans.com/",site:"zd",classify:"windows"},{name:"llm",ischecked:!0,description:"浏览迷(原浏览器之家)是一个关注浏览器及软件、IT的科技博客,致力于为广大浏览器爱好者提供一个关注浏览器、交流浏览器、折腾浏览器的专门网站",url:"http://liulanmi.com/",site:"llm",classify:"info"},{name:"爱Q生活网",ischecked:!0,description:"爱Q生活网 - 亮亮'blog -关注最新QQ活动动态, 掌握QQ第一资讯",url:"http://www.iqshw.com/",site:"iqq",classify:"info"},{name:"waitsun",ischecked:!0,chName:"爱情守望者",description:"爱情守望者博客以分享，互助和交流为宗旨，分享软件，电影，资源，设计和网络免费资源。",url:"http://www.waitsun.com/",site:"waitsun",classify:"mac"},{name:"MacPeers",ischecked:!0,url:"http://www.macpeers.com/",description:"最有价值的mac软件免费分享源，提供最新mac破解软件免费下载。",site:"MacPeers",classify:"mac"}]).constant("dataChooses",[{value:1,str:"1天内"},{value:2,str:"2天内"},{value:3,str:"3天内"},{value:5,str:"5天内"}]),angular.module("ngGather").filter("updateTimeFilter",["$filter",function(t){return function(e){return e?t("date")(e,"yy-MM-dd HH:mm"):"未知时间"}}]),angular.module("ngGather").filter("imgUrlChange",["SERVERURL",function(t){return function(e){return e&&/(zdfans)|(waitsun)/i.test(e)?t+"/api/v1/getImg?imgurl="+encodeURIComponent(e):e}}]),angular.module("ngGather").service("localSaveService",function(){this.get=function(){try{var t=JSON.parse(localStorage.getItem("shang_ngGather"))||{};return{sites:t.sites,themeType:t.themeType}}catch(e){return localStorage.removeItem("shang_ngGather"),null}},this.set=function(t,e){localStorage.setItem("shang_ngGather",JSON.stringify({sites:t,themeType:e}))}}),angular.module("ngGather").factory("sitesInfoEntity",["$resource","SERVERURL",function(t,e){return t(e+"/api/v1/sites",{},{update:{method:"PUT"}})}]).factory("updateTimeEntity",["$resource","SERVERURL",function(t,e){return t(e+"/api/v1/updateTime",{},{update:{method:"PUT"}})}]).factory("allSitesEntity",["$resource","SERVERURL",function(t,e){return t(e+"/api/v1/allSites",{},{update:{method:"PUT"}})}]),angular.module("ngGather").config(["$stateProvider","$urlRouterProvider",function(t,e){e.when("","/contents"),e.otherwise("/contents"),t.state("home",{url:"",templateUrl:"templates/home.html",controller:"chooseCtrl"}).state("home.contents",{url:"/contents",controller:"contentsCtrl"})}]),angular.module("ngGather").controller("chooseCtrl",["$scope","$timeout","$aside","themeSwitcherService","toastService","notificationService","errorHandlingService","localSaveService","sitesInfoEntity","updateTimeEntity","allSitesEntity","ALL_SITES",function(t,e,n,a,i,s,o,r,c,l,d,h){function u(){_.forEach($.chooseSite,function(e){e.ischecked&&t.sites.push(e.site)}),t.themeType&&(t.themeType=!1,t.changeTheme()),p(),t.$on("load more",function(e,n,a){a.$percentage>90&&t.addMore()}),d.get().$promise.then(function(t){t=t.allSites||[],t.forEach(function(t){var e=_.findIndex($.chooseSite,function(e){return e.site===t.site});($.chooseSite[e]||{}).latesGatherTime=t.latesGatherTime})})["catch"](function(t){})}function p(){l.get().$promise.then(function(e){t.updateTime=e.updateTime})["catch"](function(t){o.handleError(t)})}function g(){return d.get().$promise.then(function(t){t=t.allSites||[],t.forEach(function(t){var e=_.findIndex($.chooseSite,function(e){return e.site===t.site});($.chooseSite[e]||{}).latesGatherTime=t.latesGatherTime})})["catch"](function(t){})}function m(){t.ishow=!t.ishow,t.ishow&&g().then(function(){$.showSites=angular.copy($.chooseSite)})}function f(e){if(t.ishow=!t.ishow,e)return void($.showSites=$.chooseSite);var n=[];$.chooseSite=$.showSites,_.forEach($.chooseSite,function(t){t.ischecked&&n.push(t.site)}),t.sites=n,t.getData(),r.set($.chooseSite,t.themeType)}function b(){t.canForceUpdte=!1,e(function(){t.canForceUpdte=!0},12e4),s.info("强制重新采集中~~请稍后刷新~",3500),c.get({force:1}).$promise.then(function(){})["catch"](function(t){o.handleError(t)})}function v(){t.pageNu=0,t.addMore(!0),p()}function y(e){t.isSearch=!0,(e||!t.keyword)&&(t.isSearch=!1,t.keyword=""),t.pageNu=0,t.addMore(!0)}function w(n){if(0===t.addMoreState||n){e.cancel(E),E=e(function(){t.addMoreState=0},15e3),t.addMoreState=2;var a={pageNu:t.pageNu||0,updateTime:t.updateTime?new Date(t.updateTime).getTime():(new Date).getTime()};t.sites&&_.isArray(t.sites)&&(a.sites=t.sites),n&&(a.times=(new Date).getTime()),t.isSearch&&(a.keyword=t.keyword),c.query(a).$promise.then(function(e){t.addMoreState=0,t.pageNu=(t.pageNu||0)+1,n?t.contents=e:t.contents=t.contents.concat(e),e&&e.length||(t.addMoreState=1)})["catch"](function(e){t.addMoreState=0,o.handleError(e)})}}function S(){x&&x.length||(x.push({href:"/css/night/night-bb07298e58.min.css",disabled:!0}),a.replaceThemes(x)),x.forEach(function(t){t.disabled=!t.disabled}),t.themeType=!t.themeType,r.set($.chooseSite,t.themeType)}function k(t,e){g().then(function(){$.showSites=angular.copy($.chooseSite),n.open({templateUrl:"templates/choose-site.html",placement:t,size:"lg",backdrop:e,controller:["$scope","$uibModalInstance",function(t,e){t.chooseSite=$.chooseSite,t.showSites=$.showSites,t.ok=function(t){e.close(),t.stopPropagation()},t.cancel=function(t){e.dismiss(),t.stopPropagation()}}]}).result.then(function(){f()},function(){f(!0)})})}var T=r.get(),$={};t.ngModel=$,$.chooseSite=T.sites||h,t.themeType=!!T.themeType,t.addMoreState=0,t.canForceUpdte=!0,t.contents=[],t.isSearch=!1,t.ishide=!0,t.ishow=!1,t.keyword="",t.pageNu=0,t.sites=[],t.updateTime=0;var E=null,x=[];return t.addMore=w,t.changeSites=m,t.changeTheme=S,t.forceUpdate=b,t.getData=v,t.saveSites=f,t.search=y,t.openAside=k,u()}]),angular.module("ngGather").service("toastService",["$timeout",function(t){var e=[];this.setToast=function(n,a){e.length=0,e.push(n),t(function(){e.length=0},a||1500)},this.clearToast=function(){e.length=0},this.getToast=function(){return e}}]),angular.module("ngGather").directive("toast",function(){return{restrict:"AE",template:'<div class="toast" ng-show="toast && toast.length"><span class="msg">{{toast[0]}}</span></div>',replace:!0,scope:!0,controller:["$scope","toastService",function(t,e){t.toast=e.getToast()}]}}),angular.module("ngGather").service("themeSwitcherService",function(){var t=[],e=this;this.getThemes=function(){return t},this.addThemes=function(e){_.isArray(e)?t.push.apply(t,e):t.push(e)},this.removeTheme=function(e){t.splice(t.indexOf(e),1)},this.clearThemes=function(){t.length=0},this.replaceThemes=function(t){e.clearThemes(),e.addThemes(t)}}),angular.module("ngGather").directive("themeSwitcher",function(){return{restrict:"AE",template:'<link rel="stylesheet" ng-repeat="style in styles" ng-href="{{ style.href || style }}" ng-disabled="!!style.disabled"/>',replace:!0,scope:!0,controller:["$scope","themeSwitcherService",function(t,e){t.styles=e.getThemes()}]}}),angular.module("ngGather").service("notificationService",["$timeout",function(t){var e=[],n=this;this.getNotifications=function(){return e},this.removeNotification=function(t){e.splice(e.indexOf(t),1)},this.error=function(a,i){var s={type:"error",message:a};e.push(s),t(function(){n.removeNotification(s)},i||5e3)},this.warn=function(a,i){var s={type:"warn",message:a};e.push(s),t(function(){n.removeNotification(s)},i||3e3)},this.info=function(a,i){var s={type:"info",message:a};e.push(s),t(function(){n.removeNotification(s)},i||2e3)}}]),angular.module("ngGather").directive("notificationBar",function(){return{restrict:"AE",templateUrl:"components/notification/notification-bar.tpl.html",controller:["$scope","notificationService",function(t,e){t.notifications=e.getNotifications(),t.types={error:"danger",warn:"warning",info:"info"},t.close=function(e){t.notifications.splice(e,1)}}]}}),angular.module("ngGather").run(["$templateCache",function(t){t.put("templates/choose-site.html",'<div class="modal-body choose-site"><table class="table table-bordered table-striped"><tr ng-repeat="choose in (showSites || chooseSite)"><td><div class="checkbox"><label><input type="checkbox" ng-model="choose.ischecked">{{choose.name}}</label></div></td><td><a href="{{choose.url}}" target="_blank">{{choose.description}}</a></td><td><span>{{choose.latesGatherTime | updateTimeFilter}}</span></td></tr><tr><td></td><td><button class="btn btn-primary" ng-click="ok($event)">保存</button> <button class="btn btn-warning" ng-click="cancel($event)">取消</button></td><td></td></tr></table></div>'),t.put("templates/home.html",'<div><nav class="navbar navbar-default"><div class="navbar-header"><a class="navbar-brand text-center btn-link more-option" ng-click="ishide = !ishide">ngGather</a></div><ul class="nav navbar-nav navbar-left" ng-class="{\'mobile-hide\': ishide}"><li><a class="btn btn-link" ng-click="openAside(\'left\', true)">站点选择</a></li><li ng-class="{\'mobile-hide\': ishide}"><form class="navbar-form navbar-left search" role="search" ng-submit="search()"><div class="form-group"><input type="text" class="form-control" placeholder="回车搜索" ng-model="keyword"></div></form></li><li ng-show="!!keyword"><a class="btn btn-link" ng-click="search(true)">取消搜索</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-class="{\'mobile-hide\': ishide}"><a class="btn btn-link" ng-click="addMoreState !== 0 || getData()" ng-disabled="addMoreState !== 0">重新获取</a></li><li ng-class="{\'mobile-hide\': ishide}"><a class="btn btn-link" ng-click="changeTheme()">{{themeType ? \'换白色主题\' : \'换黑色主题\'}}</a></li><li><a class="btn btn-link" ng-click="!canForceUpdte || forceUpdate()" ng-disabled="!canForceUpdte">更新时间: {{updateTime | updateTimeFilter}}</a></li></ul></nav></div><div scroll-watch="{from: 0, to: -1}" sw-broadcast="{\'load more\': \'$percentage > 90\'}"><div class="row" ng-repeat="content in contents"><div class="contents"><div class="col-xs-12 col-sm-3 text-center"><a ng-href="{{content.href}}" target="_blank"><img ng-src="{{content.img | imgUrlChange}}"></a></div><div class="col-xs-12 col-sm-9"><div class="col-xs-12 col-sm-10"><a ng-href="{{content.href}}" target="_blank"><div class="title">[{{content.site}}] {{content.title}}</div></a></div><div class="col-xs-12 col-sm-2 detail">{{content.gatherTime | date:"yy/MM/dd HH:mm"}}</div><div class="col-xs-12 col-sm-12">{{content.intro}}</div></div><div class="col-xs-12 col-sm-12"><hr></div></div></div><div class="addmore text-center"><a class="btn btn-primary" ng-click="addMoreState !== 0 || addMore()" ng-disabled="addMoreState !== 0">{{[\'加载更多~\', \'没有更多了~~\', \'加载中~~\'][addMoreState]}}</a></div></div>'),t.put("components/notification/notification-bar.tpl.html",'<alert class="center-block col-sm-6" ng-repeat="notification in notifications" type="{{types[notification.type]}}" close="close($index)">{{notification.message}}</alert>'),t.put("vendor/angular-aside/demo.html",'<!DOCTYPE html><html ng-app="asideApp"><head><link data-require="bootstrap-css@3.2.0" data-semver="3.2.0" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="src/styles/animate.css"><link rel="stylesheet" href="src/styles/aside.css"><style type="text/css">/* Styles go here */\n      body {\n        padding: 30px 15px 0;\n      }\n\n      #downloadbtn {\n        margin-bottom: 10px;\n      }\n\n      .about-links {\n        color: #95a5a6;\n      }\n      .about-links a {\n        border-bottom: 1px dotted;\n        text-decoration: none;\n        margin-right: 15px;\n      }\n\n      .about-links li {line-height: 30px;}\n      .about-links li:hover, .about-links li:hover a { color: #666; }\n      .about-links .love:hover i { color: #e74c3c; }\n      .about-links .prospectus:hover i { color: #f39c12; }\n      .about-links .cypher:hover i { color: #16a085; }\n      .about-links .lab:hover i { color: #8e44ad; }</style><script src="https://code.angularjs.org/1.4.7/angular.js"></script><script src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.14.3.min.js"></script><script src="dist/js/angular-aside.min.js"></script><script>angular.module(\'asideApp\', [\'ui.bootstrap\', \'ngAside\'])\n        .controller(\'MainCtrl\', function($scope, $aside) {\n          $scope.openAside = function(position) {\n            $aside.open({\n              templateUrl: \'aside.html\',\n              placement: position,\n              backdrop: true,\n              controller: function($scope, $modalInstance) {\n                $scope.ok = function(e) {\n                  $modalInstance.close();\n                  e.stopPropagation();\n                };\n                $scope.cancel = function(e) {\n                  $modalInstance.dismiss();\n                  e.stopPropagation();\n                };\n              }\n            })\n          }\n        });</script><script type="text/ng-template" id="aside.html"><div class="modal-header">\n          <h3 class="modal-title">ngAside</h3>\n      </div>\n      <div class="modal-body">\n        Look im in aside.\n      </div>\n      <div class="modal-footer">\n          <button class="btn btn-primary" ng-click="ok($event)">OK</button>\n          <button class="btn btn-warning" ng-click="cancel($event)">Cancel</button>\n      </div></script></head><body ng-controller="MainCtrl"><div class="container"><div class="jumbotron panel panel-default"><h1>Angular Aside</h1><p>Off canvas side menu to use with ui-bootstrap. Extends ui-bootstrap\'s $modal provider.</p><p><a href="https://github.com/dbtek/angular-aside" class="btn btn-primary btn-lg" id="downloadbtn"><span class="glyphicon glyphicon-download"></span> Download</a><br><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://github.com/dbtek/angular-aside" data-via="dbtek">Tweet</a><iframe src="http://ghbtns.com/github-btn.html?user=dbtek&repo=angular-aside&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="107" height="20"></iframe></p><div><ul class="text-center about-links list-inline"><li class="love">made with <i class="fa fa-heart"></i> by <a href="http://twitter.com/dbtek" onclick="_gaq.push([\'_trackEvent\', \'Outbound Link\', \'View twitter account\'])">@dbtek</a></li><li class="lab"><i class="fa fa-flask"></i> <a href="https://github.com/dbtek/angular-aside">github project</a></li><li class="cypher"><i class="fa fa-code"></i> <a href="http://opensource.org/licenses/MIT">license: MIT</a></li></ul></div></div><div class="jumbotron panel panel-default"><h2>Demo</h2><p><span class="pull-left"><button type="button" class="btn btn-default btn-lg" ng-click="openAside(\'left\')"><span class="glyphicon glyphicon-align-justify"></span> Left</button> <button type="button" class="btn btn-default btn-lg" ng-click="openAside(\'top\')">Up <span class="glyphicon glyphicon-arrow-down"></span></button></span> <span class="pull-right"><button type="button" class="btn btn-default btn-lg" ng-click="openAside(\'bottom\')">Down <span class="glyphicon glyphicon-arrow-up"></span></button> <button type="button" class="btn btn-default btn-lg" ng-click="openAside(\'right\')">Right <span class="glyphicon glyphicon-align-justify"></span></button></span></p><div class="clearfix"></div><br><div class="text-center"><ins class="adsbygoogle text-center" style="display:inline-block;width:320px;height:100px" data-ad-client="ca-pub-7616772085785107" data-ad-slot="4180012826"></ins></div></div></div><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><script>(function(i,s,o,g,r,a,m){i[\'GoogleAnalyticsObject\']=r;i[r]=i[r]||function(){\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n      })(window,document,\'script\',\'http://www.google-analytics.com/analytics.js\',\'ga\');\n\n      ga(\'create\', \'UA-46512232-6\', \'auto\');\n      ga(\'send\', \'pageview\');</script><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?\'http\':\'https\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+\'://platform.twitter.com/widgets.js\';fjs.parentNode.insertBefore(js,fjs);}}(document, \'script\', \'twitter-wjs\');</script></body></html>')}]);